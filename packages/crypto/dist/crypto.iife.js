var crypto=function(n,e,w){"use strict";const s=process.env.ENCRYPTION_SECRET_JWT,a=process.env.ENCRYPTION_SECRET_JWE;let r,o;(async()=>{if(!(r&&o)){if(!s)throw new Error("JWT encryption secret is not found in env.");if(!a)throw new Error("JWE encryption secret is not found in env.");r=await e.importPKCS8(s,"ES256"),o=await e.importPKCS8(a,"ECDH-ES+A128KW")}})().then(()=>console.log("@qnx/crypto initiated."));const y=async c=>{const t=w.v4(),i=await new e.SignJWT({}).setProtectedHeader({typ:"JWT",alg:"ES256"}).setIssuedAt().setExpirationTime("30d").setIssuer("https://mysite.com").setSubject(c).setJti(t).sign(r);return{token:await new e.CompactEncrypt(new TextEncoder().encode(i)).setProtectedHeader({alg:"ECDH-ES+A128KW",enc:"A256CBC-HS512"}).encrypt(o),dbToken:t}},p=async c=>{try{const{plaintext:t}=await e.compactDecrypt(c,o),i=new TextDecoder().decode(t),{payload:d}=await e.jwtVerify(i,r,{issuer:"https://mysite.com"});return d}catch{throw new Error("Token decode error")}};return n.decyptToken=p,n.generateToken=y,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),n}({},jose,uuid);
