var crypto=function(n,e,d){"use strict";const s=process.env.ENCRYPTION_SECRET_JWT,a=process.env.ENCRYPTION_SECRET_JWE;let r,c;(async()=>{if(!(r&&c)){if(!s)throw new Error("JWT encryption secret is not found in env.");if(!a)throw new Error("JWE encryption secret is not found in env.");r=await e.importPKCS8(s,"ES256"),c=await e.importPKCS8(a,"ECDH-ES+A128KW")}})();const y=async o=>{const t=d.v4(),i=await new e.SignJWT({}).setProtectedHeader({typ:"JWT",alg:"ES256"}).setIssuedAt().setExpirationTime("30d").setIssuer("https://mysite.com").setSubject(o).setJti(t).sign(r);return{token:await new e.CompactEncrypt(new TextEncoder().encode(i)).setProtectedHeader({alg:"ECDH-ES+A128KW",enc:"A256CBC-HS512"}).encrypt(c),dbToken:t}},p=async o=>{try{const{plaintext:t}=await e.compactDecrypt(o,c),i=new TextDecoder().decode(t),{payload:w}=await e.jwtVerify(i,r,{issuer:"https://mysite.com"});return w}catch{throw new Error("Token decode error")}};return n.decyptToken=p,n.generateToken=y,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),n}({},jose,uuid);
